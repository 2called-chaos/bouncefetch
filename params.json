{"name":"Bouncefetch","tagline":"Bouncefetch is a Ruby CLI application which searches an IMAP account for bounce mails, categorizes them and maintains a list of failed recipients which you can export to do whatever you want (unsubscribe, require reconfirmation, etc.).","body":"# Bouncefetch [![version 0.1.1](http://img.shields.io/badge/version-0.1.1-brightgreen.svg)](https://github.com/2called-chaos/bouncefetch/blob/master/VERSION) [![MIT License](http://img.shields.io/badge/license-MIT-yellowgreen.svg)](https://github.com/2called-chaos/bouncefetch/blob/master/LICENSE.txt) [![have faith!](http://img.shields.io/badge/coverage-have%20faith!-blue.svg)](http://www.troll.me/images/faith-fall/have-faith-weve-only-dropped-two-people-so-far.jpg) [![weather sunny](http://img.shields.io/badge/weather-sunny-yellow.svg)](http://i1.ytimg.com/vi/2e6BwPAvopY/maxresdefault.jpg)\r\n\r\n***\"bounces should be read by humans\"* – we don't think so!**\r\n\r\nBouncefetch is a Ruby CLI application which searches an IMAP account for bounce mails, categorizes them and maintains a list\r\nof failed recipients which you can export to do whatever you want (unsubscribe, require reconfirmation, etc.).\r\n\r\n![screenshot](http://blog.bmonkeys.net/attach/cc86b1d570414e42ae6f851187d82d73/original_bouncefetch.png)\r\n\r\n## Features\r\n\r\n* easy and flexible configuration\r\n* classifies bounces with the [build-in rules](https://github.com/2called-chaos/bouncefetch/blob/master/config/rules.rb) (custom ones are easily added)\r\n* maintains an exportable database of failed recipients and their causes (no actual database required)\r\n* export to CSV file or post to remote http(s) endpoint (perfect for automatisation)\r\n* interactive inspect mode to define new rules\r\n* few dependencies (ruby and the mail gem (pry is optional))\r\n\r\n\r\n\r\n## Requirements\r\n\r\n* Git (optional if you download the archive instead of cloning the repository)\r\n* Ruby >= 1.9.3 (2.0 highly recommended!)\r\n* [Bundler](http://bundler.io) gem (`gem install bundler`)\r\n* IMAP credentials\r\n\r\n\r\n\r\n## Installation\r\n\r\nChoose and cd into the directory where you want to install Bouncefetch and clone the project:\r\n\r\n    cd /opt\r\n    git clone https://github.com/2called-chaos/bouncefetch.git\r\n    cd bouncefetch\r\n\r\nCopy the sample configuration and edit it to your needs (see Configuration):\r\n\r\n    cp config/config.rb.example config/config.rb\r\n    vim config/config.rb\r\n\r\nIf you want to define custom rules (and you want, sooner or later) do the same with the example rule file.\r\nIt just contains comments so you don't have to bother with it for now.\r\n\r\n    cp config/custom_rules.rb.example config/custom_rules.rb\r\n\r\nInstall dependencies:\r\n\r\n    bundle install\r\n\r\n**Optionally:** Make the executable available in your $PATH by either\r\n\r\n* adding `/opt/bouncefetch/bin` (or whatever you have choosen) to your path (**recommended**)<br>\r\n  [» How to add a directory to my path](http://askubuntu.com/questions/60218/how-to-add-a-directory-to-my-path)\r\n* symlinking the executable<br>\r\n  `ln -s /opt/bouncefetch/bin/bouncefetch /usr/local/bin/bouncefetch`\r\n\r\n\r\n\r\n\r\n## Usage\r\n\r\n    Usage: bouncefetch [options]\r\n\r\n    # General settings\r\n    -d, --dryrun                     Don't alter IMAP account or registry\r\n    -m, --monochrome                 Don't colorize output\r\n    -t, --throttle-ignore            Disable IMAP throttle detection\r\n    -i, --inspect                    Open pry shell for every mail which is unidentifyable, unmatched or has\r\n                                     no matching crosscheck. Use --shell beforehand to get more help on pry.\r\n\r\n    # Registry & Export\r\n    -s, --statistics                 show statistics about the registry and candidates\r\n    -c, --candidates                 list unsubscribe candidates (use export to get csv)\r\n    -e, --export FILE                export unsubscribe candidates to file and remove them from the registry\r\n                                     use with --dryrun to not alter registry (same for --remote)\r\n    -r, --remote RESOURCE            post unsubscribe candidates to URL and remove them from the registry\r\n                                     refer to the readme for information about how we post the data\r\n    -o, --output col1,col2           columns to include for --candidates --export --remote\r\n                                     default: ref,sbounces,hbounces,sbounces_dates,hbounces_dates,sbounces_reasons,hbounces_reasons\r\n\r\n    # Miscellaneous\r\n    -h, --help                       Shows this help\r\n    -v, --version                    Shows version and other info\r\n    -z                               Do not check for updates on GitHub (with -v/--version)\r\n        --mailboxes                  List all availables mailboxes in your IMAP account\r\n        --shell                      Open pry shell\r\n\r\n\r\n\r\n## Configuration\r\n\r\n### config.rb » identification_header\r\n\r\nWhen a mail bounces you typically get a copy of the original mail you've send. To identify the user it is best to add a custom header to all mails you send out.\r\nIf your users have the ability to change their email addresses it would be a good idea to set this header to the user database id or some kind of token.\r\n\r\nIf you can't or don't want to use this you can leave it blank and bouncefetch will try to determine it by other means.\r\n\r\n\r\n### Defining rules\r\n\r\nRules are pretty easy to define. You should add them to `custom_rules.rb` so that you are able to update the shipped default set `rules.rb` without hassle. You still may want to take a look inside for examples.\r\n\r\nThere are 3 different possibilities to define a rule:\r\n\r\n* **string** matches if string is in mail body (case insensitive)\r\n* **regexp** matches if body matches regex (use i modifier for case insensitivity)\r\n* **block** matches if the block returns a truethy value (yields the mail object).\r\n  You can pass a descriptive name as first argument (see the examples).\r\n\r\nYou can also pass an second argument `crosscheck` which defaults to true and can be set to false. When set to false and the mail matches this rule it does not require a matching crosscheck.\r\n\r\n```ruby\r\nrule(\"foo\", false)\r\nrule(\"blub\", false) {|m| \"…\" }\r\n```\r\n\r\n\r\n### What happens with unhandled emails?\r\n\r\nIf you'd run bouncefetch and then take a look into your IMAP account you might find:\r\n\r\n* **unread messages** no search query have matched this mails so bouncefetch never got this mail\r\n* **read messages** the mail got fetched by bouncefetch but couldn't be handled, possible causes:\r\n  * **unmatched** no rule has matched\r\n  * **no crosscheck** a rule has matched but no crosscheck did\r\n  * **no candidate** mail was handled but no candidate reference could be found\r\n  * **leave mapping** a rule matched but the cause mapping in config.rb is set to `leave`\r\n  * **fail** bouncefetch totally failed and raised an exception\r\n\r\nBest strategy is to run bouncefetch once normally and then with `-i` resp. `--inspect`. This will open\r\nup an interactive [pry](http://pryrepl.org/) session which let you easily investigate and test new rules.\r\n\r\n\r\n\r\n## Export\r\n\r\nYou can export the candidates to a CSV file to further process the data. Only candidates which have reached your configured limits will be exported.\r\n\r\n    bouncefetch -e candidates.csv\r\n\r\nAfter successfully writing the CSV to disk the exported candidates **will be removed from the internal database**. If you don't want this use `-d` resp. `--dryrun`.\r\n\r\n    bouncefetch -de candidates.csv\r\n\r\nBy default all columns will be exported which are:\r\n\r\n* **reference** reference of your identification_header or email address\r\n* **soft/hard_bounces** amount of soft/hard bounces registered\r\n* **soft/hard_bounce_dates** dates (without time) when the bounces were registered (separated by `@@@`)\r\n* **soft/hard_bounce_reasons** the rule conditions which have matched each bounce (separated by `@@@`)\r\n\r\nYou can specify which columns should be exported by passing `-o` resp. `--output` argument (note the shortened names):\r\n\r\n    bouncefetch -e candidates.csv -o ref,sbounces,hbounces,sbounces_dates,hbounces_dates,sbounces_reasons,hbounces_reasons\r\n\r\n\r\n\r\n### Remote export\r\n\r\nRemote export functions like the normal CSV export (same behaviour/options) but POSTs the data as array to a remote HTTP(S) endpoint.\r\n\r\nBouncefetch POSTs a JSON string on query key candidates `\"candidates\" => \"JSON encoded string\"`\r\n\r\nThis is an example of the parsed JSON:\r\n\r\n```json\r\n> JSON.parse(params[:candidates])\r\n=> \"foo@example.com\" => {\r\n     \"reference\" => \"foo@example.com\",\r\n     \"soft_bounces\" => 0,\r\n     \"hard_bounces\" => 1,\r\n     \"soft_bounce_dates\" => [],\r\n     \"hard_bounce_dates\" => [\"2014-06-03\"],\r\n     \"soft_bounce_reasons\" => [],\r\n     \"hard_bounce_reasons\" => [\"account is disabled\"]\r\n   },\r\n   \"bar@example.com\" => {\r\n     \"reference\" => \"bar@example.com\",\r\n     \"soft_bounces\" => 0,\r\n     \"hard_bounces\" => 1,\r\n     \"soft_bounce_dates\" => [],\r\n     \"hard_bounce_dates\" => [\"2014-06-04\"],\r\n     \"soft_bounce_reasons\" => [],\r\n     \"hard_bounce_reasons\" => [\"unrouteable address\"]\r\n   }\r\n```\r\n\r\n\r\n\r\n## Todo\r\n\r\n* Handle bounces where the original email is attached rather than inline (currently attachments are ignored)\r\n* Handle bounces with no body to at least check the subject (currenlty mails with no body will be fail-skipped)\r\n* Support multiple IMAP accounts or configurations\r\n* Increase performance (it's a bit slow)\r\n\r\n\r\n\r\n## Contributing\r\n\r\nI started this project to create a comprehensive ruleset to classify bounces so please contribute!\r\nYou can contribute by **giving feedback**, **propose rules** or **report issues**.\r\n\r\nIf you want to contribute code directly:\r\n\r\n1. Fork it ([click to fork](http://github.com/2called-chaos/bouncefetch/fork))\r\n2. Create your feature branch (`git checkout -b my-new-feature`)\r\n3. Commit your changes (`git commit -am 'Add some feature'`)\r\n4. Push to the branch (`git push origin my-new-feature`)\r\n5. Create new Pull Request\r\n\r\n\r\n\r\n## License\r\n\r\nCopyright © 2014 Sven Pachnit (sven@bmonkeys.net).<br>\r\nReleased under the MIT License, see [LICENSE.txt](https://github.com/2called-chaos/bouncefetch/blob/master/LICENSE.txt) for details.\r\n\r\n\r\n\r\n## More from bmonkeys\r\n\r\n* http://blog.bmonkeys.net\r\n* https://de.gamesplanet.com\r\n* https://github.com/2called-chaos/dle    Directory List Edit – Edit file structures in your favorite editor!\r\n* https://github.com/2called-chaos/ts3r   A little framework to build teamspeak 3 bots.\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}